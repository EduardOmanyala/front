{% extends "frontmain/main.html" %}
{% block title %}Payments{% endblock %}
{% load static %}
{% block content %}

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');


    .formbold-main-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 48px;
      
    }
  
    .formbold-form-wrapper {
      margin: 0 auto;
      max-width: 550px;
      width: 100%;
      background: white;
    }
  
    .formbold-form-title {
      margin-bottom: 40px;
    }
    .formbold-form-title h3 {
      color: #07074D;
      font-weight: 700;
      font-size: 28px;
      line-height: 35px;
      width: 60%;
      margin-bottom: 20px;
    }
    .formbold-form-title p {
      font-size: 16px;
      line-height: 24px;
      color: #536387;
      width: 70%;
    }
    .formbold-form-input {
      text-align: center;
      width: 100%;
      padding: 14px 22px;
      border-radius: 6px;
      border: 1px solid #DDE3EC;
      background: #FAFAFA;
      font-weight: 500;
      font-size: 16px;
      color: #536387;
      outline: none;
      resize: none;
    }
    .formbold-form-input:focus {
      border-color: #6a64f1;
      box-shadow: 0px 3px 8px rgba(0, 0, 0, 0.05);
    }
  
    .formbold-btn {
      text-align: center;
      width: 100%;
      font-size: 16px;
      border-radius: 5px;
      padding: 14px 25px;
      border: none;
      font-weight: 500;
      background-color: #6A64F1;
      color: white;
      cursor: pointer;
      margin-top: 15px;
    }
    .formbold-btn:hover {
      box-shadow: 0px 3px 8px rgba(255, 0, 0, 0.2);
      background-color: grey;
    }




    /* CSS for the loading spinner */
.button-loader {
  position: relative;
  overflow: hidden;
}

.button-loader:after {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: 24px;
  height: 24px;
  margin: -12px 0 0 -12px;
  border: 4px solid #fff;
  border-top: 4px solid #3498db;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  box-sizing: border-box;
  transform-origin: 50% 50%;
}

@keyframes spin {
  0% { 
    transform: rotate(0deg); 
  }
  100% { 
    transform: rotate(360deg); 
  }
}



  
  </style>


<section>
    <div class="orderdetails">
        <div></div>
        <div class="mt-3">

           <div id="paysuccess" style="display: none;">
            <img src="{% static 'frontmain/images2/7efs.gif' %}" style="width: 50%;margin: auto;display: block;" alt="Computer man" >
           </div>





          
            
            <div class="formbold-main-wrapper">
                <!-- Author: FormBold Team -->
                <!-- Learn More: https://formbold.com -->
                <div class="formbold-form-wrapper">



                    <div id="entpin" style="display: none;" class="formbold-form-title">
                        <h3>Check your Phone</h3>
                        <p>Check your phone, a prompt has been sent with payment details</p>
                    </div>

                    








                  <div class="formbold-form-title">
                      <h3>Pay with m-pesa</h3>
                      <p>Enter your mobile number and click continue to make a payment</p>
                  </div>
                  <form id="post-form">
                    {% csrf_token %}
                      <input
                        type="text"
                        name="phonenumber"
                        id="phonenumber"
                        placeholder="Enter phonumber, 07000"
                        class="formbold-form-input"
                      />
              
                      <button type="submit" id="loading-button" class="formbold-btn" >
                          Continue
                      </button>

                      {% comment %} <div class="loader">
                        <div class="loading">
                        </div>
                      </div> {% endcomment %}





                  </form>
                </div>
              </div>



        </div>
        <div></div>
    </div>

    <script type="text/javascript">
     // JavaScript for the loading button
const button = document.getElementById("loading-button");

button.addEventListener("click", () => {

    setTimeout(() => {
        // Re-enable the button
        button.disabled = true;
        button.innerText = "Postings";
        button.classList.add("button-loader");

      }, 850); // Simulated 2-second task
  // Disable the button to prevent multiple clicks
 

  // Add the loading animation CSS class
 

  // Simulate an asynchronous task (replace this with your actual task)
 
});

    </script> 


    <script type="text/javascript">
        let cost = "{{cost}}"
        let order_id = "{{order_id}}"
        $(document).on('submit', '#post-form', function(e){
            e.preventDefault();

            $.ajax({
                type:'POST',
                url:'/stkpush',
                data: {
                    phonenumber: $('#phonenumber').val(),
                    order_pk: order_id,
                    price:cost,
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
                },


                success: function (){

                    $("#entpin").show();


                }
                
            });
        });



    </script>

    <div>

        <button id="ajax-button">Get Data</button>




<script>

      function fetchdata(){
        $.ajax({
            url: '{% url "get_payment" order_id %}',
            type: 'GET',
            success: function(data){
                // Perform operation on return value
                $("#paysuccess").show();
                //window.location.href = '{% url "payment-complete" order_id %}'; 
                window.location.href= '{% url "home" %}';

                  //setTimeout(function () {
                    //window.location.href = '{% url "payment-red-email" order_id %}'; //will redirect to your blog page (an ex: blog.html)
                 //}, 2000);




            },
            complete:function(data){
                setTimeout(fetchdata,7000);
            }
        });
    }
    
    $(document).ready(function(){
        setTimeout(fetchdata,5000);
    });


</script>




    </div>


    

</section>
{% endblock %}

